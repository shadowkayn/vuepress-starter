name: Deploy VuePress Site

on:
  push:
    branches:
      - master

jobs:
  build-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ›ï¸ æ£€å‡ºä»£ç 
        uses: actions/checkout@v3

      - name: ğŸ”§ è®¾ç½® Node.js ç¯å¢ƒ
        uses: actions/setup-node@v3
        with:
          node-version: '20'
          registry-url: 'https://registry.npmjs.org'
          # é‡è¦ï¼šä¸è®¾ç½®ç¼“å­˜ç±»å‹æˆ–è®¾ç½®ä¸º 'npm'ï¼Œé¿å… setup-node æ··æ·†
          # æˆ‘ä»¬ä¼šæ‰‹åŠ¨å®‰è£… pnpm å¹¶ç®¡ç†å…¶ PATH
          cache: 'npm'

      - name: ğŸ“¦ æ‰‹åŠ¨å®‰è£… pnpm v8
        # è¿™æ˜¯ä¸€ç§æ›´ç›´æ¥å’Œå¯é çš„ pnpm å®‰è£…æ–¹å¼
        run: |
          npm install -g pnpm@8 # æˆ–è€…ç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶
          # éªŒè¯ pnpm æ˜¯å¦åœ¨ PATH ä¸­
          pnpm -v
        env:
          # ç¡®ä¿ PNPM_HOME è¢«è®¾ç½®ï¼Œå¹¶ä¸”åœ¨ PATH ä¸­
          # é€šå¸¸ npm -g å®‰è£…çš„åŒ…ä¼šè‡ªåŠ¨æ·»åŠ åˆ° PATH
          PNPM_HOME: ${{ runner.tool_cache }}/pnpm/8.x/x64 # è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹è·¯å¾„ï¼Œå®é™…ç”± npm -g å†³å®š

      - name: ğŸ“¦ å®‰è£…é¡¹ç›®ä¾èµ–
        # ç¡®ä¿ pnpm åœ¨é¡¹ç›®æ ¹ç›®å½•å®‰è£…ä¾èµ–ï¼Œå¹¶ä¸”å¯ä»¥æ¥å—éä¸¥æ ¼æ¨¡å¼
        run: pnpm install --no-frozen-lockfile

      - name: âœ… æ‰¹å‡†æ„å»ºè„šæœ¬
        run: pnpm approve-builds @parcel/watcher esbuild vue-demi

      - name: ğŸ”§ å®‰è£… sassï¼ˆå¯é€‰ï¼‰
        run: pnpm add -D sass-embedded sass

      - name: ğŸ”§ é…ç½® Git ç”¨æˆ·
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: ğŸ—ï¸ æ„å»º VuePress
        run: pnpm run build

      - name: ğŸš€ éƒ¨ç½²åˆ° GitHub Pages
        run: pnpm run deploy
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}