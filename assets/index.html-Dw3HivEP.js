import{_ as s,c as a,a as p,o as t}from"./app-DT6LNIAZ.js";const e={};function c(l,n){return t(),a("div",null,n[0]||(n[0]=[p(`<h3 id="前端开发中最核心、最能提升你代码质量的-5-个-设计模式" tabindex="-1"><a class="header-anchor" href="#前端开发中最核心、最能提升你代码质量的-5-个-设计模式"><span>前端开发中最核心、最能提升你代码质量的 5 个 设计模式</span></a></h3><h4 id="_1、策略模式-strategy-pattern-解决代码里的-屎山-if-else-最简单且立竿见影" tabindex="-1"><a class="header-anchor" href="#_1、策略模式-strategy-pattern-解决代码里的-屎山-if-else-最简单且立竿见影"><span>1、策略模式(Strategy Pattern)（解决代码里的“屎山” if-else，最简单且立竿见影）</span></a></h4><p>它解决什么问题？ 当你发现你的代码里出现了超过 3 层以上的 if...else 或者 switch...case，而且逻辑非常类似时，代码就会变得难以维护（改一处错全身）。策略模式就是要把**“判断逻辑”和“执行逻辑”**分开。</p><h5 id="_1-1、业务场景" tabindex="-1"><a class="header-anchor" href="#_1-1、业务场景"><span>1.1、业务场景</span></a></h5><p>假设你正在写一个“年终奖计算”的函数。根据员工的表现等级（S、A、B），发放不同的奖金倍数：</p><ul><li>S 级：4 倍工资</li><li>A 级：3 倍工资</li><li>B 级：2 倍工资</li></ul><h5 id="_1-2、普通写法-屎山-雏形" tabindex="-1"><a class="header-anchor" href="#_1-2、普通写法-屎山-雏形"><span>1.2、普通写法（“屎山”雏形）</span></a></h5><p>这种写法不仅难看，而且如果以后增加了 C 级，或者 S 级的倍数改了，你得不停地修改这个函数内部。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token function-variable function">calculateBonus</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">level<span class="token punctuation">,</span> salary</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>level <span class="token operator">===</span> <span class="token string">&#39;S&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> salary <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>level <span class="token operator">===</span> <span class="token string">&#39;A&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> salary <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>level <span class="token operator">===</span> <span class="token string">&#39;B&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> salary <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">calculateBonus</span><span class="token punctuation">(</span><span class="token string">&#39;S&#39;</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 40000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_1-3、策略模式写法-优雅进阶" tabindex="-1"><a class="header-anchor" href="#_1-3、策略模式写法-优雅进阶"><span>1.3、策略模式写法（优雅进阶）</span></a></h5><p>把“判断”的动作交给一个映射对象，函数只负责“执行”。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 1. 定义策略对象（所有的逻辑都在这里，非常清晰）</span></span>
<span class="line"><span class="token keyword">const</span> bonusStrategies <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;S&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> salary <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;A&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> salary <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;B&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> salary <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;C&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> salary <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 以后加等级，直接在这里加一行就行</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 2. 执行函数（这一行代码永远不需要改动）</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">calculateBonus</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">level<span class="token punctuation">,</span> salary</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> bonusStrategies<span class="token punctuation">[</span>level<span class="token punctuation">]</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">calculateBonus</span><span class="token punctuation">(</span><span class="token string">&#39;S&#39;</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 40000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_1-4、前端实战-表单验证" tabindex="-1"><a class="header-anchor" href="#_1-4、前端实战-表单验证"><span>1.4、前端实战：表单验证</span></a></h5><p>这是策略模式在前端最经典的用法。不要在提交表单时写一堆 if (!value) { ... }，而是定义一套校验规则。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 校验策略</span></span>
<span class="line"><span class="token keyword">const</span> rules <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function-variable function">isNonEmpty</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> errorMsg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token keyword">return</span> errorMsg<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function-variable function">minLength</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> length<span class="token punctuation">,</span> errorMsg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token keyword">return</span> errorMsg<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function-variable function">isEmail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> errorMsg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\\w+@\\w+\\.\\w+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> errorMsg<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 使用时只需要调用对应的策略名即可</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、单例模式-singleton-pattern-理解全局唯一实例的概念-处理全局状态" tabindex="-1"><a class="header-anchor" href="#_2、单例模式-singleton-pattern-理解全局唯一实例的概念-处理全局状态"><span>2、单例模式(Singleton Pattern)（理解全局唯一实例的概念，处理全局状态）</span></a></h4><p>在前端开发中，这个模式的出现频率极高，甚至你可能已经在不知不觉中用过它了。</p><h5 id="_2-1、什么是单例模式" tabindex="-1"><a class="header-anchor" href="#_2-1、什么是单例模式"><span>2.1、什么是单例模式？</span></a></h5><p>单例模式的定义： 确保一个类只有一个实例，并提供一个访问它的全局访问点。</p><p>通俗点说： 有些东西在整个应用运行期间，有且只能有一个。比如：</p><ul><li>登录弹窗： 不管用户点多少次，页面上只应该弹出一个登录框，而不是叠罗汉。</li><li>全局状态管理 (Vuex / Redux)： 整个应用只能有一个 Store，否则数据就乱套了。</li><li>购物车： 同一个用户的购物车，在整个购物流程中应该是同一个对象。</li></ul><h5 id="_2-2、为什么需要它" tabindex="-1"><a class="header-anchor" href="#_2-2、为什么需要它"><span>2.2、为什么需要它？</span></a></h5><p>如果不使用单例，每次需要这些功能时都 new 一个新对象，会造成：</p><ul><li>性能浪费： 频繁创建/销毁重量级对象（比如 DOM 节点、数据库连接）。</li><li>数据不同步： 如果有两个 Store 实例，你在 A 存了钱，B 里的余额却没变，这很致命。</li></ul><h5 id="_2-3、代码演练-写一个全局唯一的-loading-遮罩层" tabindex="-1"><a class="header-anchor" href="#_2-3、代码演练-写一个全局唯一的-loading-遮罩层"><span>2.3、代码演练：写一个全局唯一的“Loading 遮罩层”</span></a></h5><p>假设你要做一个全局的 Loading 效果。</p><p>普通写法（容易出错） 每次调用 showLoading 都创建一个新 DOM，页面会堆积无数个节点。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&#39;加载中...&#39;</span><span class="token punctuation">;</span></span>
<span class="line">  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>单例模式写法（正解） <br> 核心思路是：用一个变量（闭包）来保存已经创建好的实例。如果实例已经存在，就直接返回它；如果不存在，再创建。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 使用闭包来实现单例</span></span>
<span class="line"><span class="token keyword">const</span> Loading <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 存储实例的“秘密仓库”</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// 如果没有，就创建一个</span></span>
<span class="line">      instance <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      instance<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&#39;加载中...&#39;</span><span class="token punctuation">;</span></span>
<span class="line">      instance<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">;</span></span>
<span class="line">      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> instance<span class="token punctuation">;</span> <span class="token comment">// 永远返回这同一个实例</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 无论调用多少次，拿到的永远是同一个 DOM 节点</span></span>
<span class="line"><span class="token keyword">const</span> loading1 <span class="token operator">=</span> <span class="token function">Loading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> loading2 <span class="token operator">=</span> <span class="token function">Loading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>loading1 <span class="token operator">===</span> loading2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-4、业务实现-电商项目中的-全局购物车数据管理器" tabindex="-1"><a class="header-anchor" href="#_2-4、业务实现-电商项目中的-全局购物车数据管理器"><span>2.4、业务实现：电商项目中的“全局购物车数据管理器”</span></a></h5><p>在很多电商应用（比如某宝、某东）里，无论你在首页、详情页，还是搜索页，右上角那个“购物车小图标”里的数字，以及你点开后的列表，都必须是实时同步且全站唯一的。</p><p>这就是对象字面量单例最发光发热的场景。</p><p>业务场景：全局购物车 (CartManager) 如果你不使用单例，而是每个页面自己管自己的购物车，那用户在详情页“加入购物车”，回到首页时发现数字还是 0，这生意就没法做了。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// CartManager.js - 购物车单例</span></span>
<span class="line"><span class="token keyword">const</span> CartManager <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 1. 初始化时直接从本地读取，如果没有则为空数组</span></span>
<span class="line">    <span class="token literal-property property">items</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&#39;my_cart&#39;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39;[]&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">addItem</span><span class="token punctuation">(</span><span class="token parameter">product</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// ... 添加逻辑 ...</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 2. 状态改变后，顺手存进本地（这就是封装带来的便利）</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_saveToLocal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 3. 内部私有方法，不暴露给外面（约定俗成用 _ 开头）</span></span>
<span class="line">    <span class="token function">_saveToLocal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;my_cart&#39;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">getTotalCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span>length<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> CartManager<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3、工厂模式-解决-对象创建-的逻辑混乱" tabindex="-1"><a class="header-anchor" href="#_3、工厂模式-解决-对象创建-的逻辑混乱"><span>3、工厂模式（解决“对象创建”的逻辑混乱）</span></a></h4><h5 id="_3-1、什么是工厂模式" tabindex="-1"><a class="header-anchor" href="#_3-1、什么是工厂模式"><span>3.1、什么是工厂模式？</span></a></h5><p>工厂模式的定义： 定义一个创建对象的接口，但让子类决定实例化哪一个类。工厂方法让类的实例化推迟到子类。</p><p>通俗点说： 你不需要自己亲手去 new 一个个复杂的对象，你只需要给“工厂”发个指令（传个参数），它就会根据你的需求，自动生产出对应的产品。</p><h5 id="_3-2、为什么需要它" tabindex="-1"><a class="header-anchor" href="#_3-2、为什么需要它"><span>3.2、为什么需要它？</span></a></h5><p>在实际业务中，创建一个对象可能非常麻烦，需要配置很多参数。</p><ul><li>如果不使用工厂： 你在代码的各个地方都要写一堆重复的 new 逻辑。一旦底层类名改了，或者初始化逻辑变了，你得全局搜索并修改。</li><li>如果使用工厂： 你只需要改“工厂”内部的一处代码，外部调用者完全无感知。这就是封装变化。</li></ul><h5 id="_3-3、代码演练-写一个-工厂" tabindex="-1"><a class="header-anchor" href="#_3-3、代码演练-写一个-工厂"><span>3.3、代码演练：写一个“工厂”</span></a></h5><p>假设一个后台管理系统，不同等级的用户看到的按钮是不一样的。创建一个“按钮工厂”，你告诉它角色，它给你成品。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">ButtonFactory</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 这就是工厂生产线的“开关”</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token function">createButton</span><span class="token punctuation">(</span><span class="token parameter">role</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">switch</span> <span class="token punctuation">(</span>role<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">case</span> <span class="token string">&#39;admin&#39;</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AdminButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">case</span> <span class="token string">&#39;editor&#39;</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">EditorButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">case</span> <span class="token string">&#39;user&#39;</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;未知角色&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 业务代码里：变简洁了，且不再依赖具体的 Button 类名</span></span>
<span class="line"><span class="token keyword">const</span> btn <span class="token operator">=</span> ButtonFactory<span class="token punctuation">.</span><span class="token function">createButton</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">btn<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-4、前端实战-封装-axios-实例" tabindex="-1"><a class="header-anchor" href="#_3-4、前端实战-封装-axios-实例"><span>3.4、前端实战：封装 Axios 实例</span></a></h5><p>这是前端最常见的“工厂”影子。你不会在每个页面都配置一遍超时时间、请求头，而是创建一个工厂函数。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">createRequest</span><span class="token punctuation">(</span><span class="token parameter">baseUrl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">baseURL</span><span class="token operator">:</span> baseUrl<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">&#39;X-Custom-Header&#39;</span><span class="token operator">:</span> <span class="token string">&#39;foobar&#39;</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 生产出针对不同业务线的请求实例</span></span>
<span class="line"><span class="token keyword">const</span> userRequest <span class="token operator">=</span> <span class="token function">createRequest</span><span class="token punctuation">(</span><span class="token string">&#39;/api/user&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> orderRequest <span class="token operator">=</span> <span class="token function">createRequest</span><span class="token punctuation">(</span><span class="token string">&#39;/api/order&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4、观察者-发布订阅模式-前端通信的底层逻辑-必学" tabindex="-1"><a class="header-anchor" href="#_4、观察者-发布订阅模式-前端通信的底层逻辑-必学"><span>4、观察者/发布订阅模式（前端通信的底层逻辑，必学）</span></a></h4><h5 id="_4-1、什么是观察者模式-observer-pattern" tabindex="-1"><a class="header-anchor" href="#_4-1、什么是观察者模式-observer-pattern"><span>4.1、什么是观察者模式(Observer Pattern)？</span></a></h5><p>定义： 定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。</p><p>通俗点说： 它就像**“订阅公众号”**。</p><ul><li>发布者（Subject）： 比如“人民日报”公众号。</li><li>观察者（Observer）： 比如你、我、他。</li><li>动作： 我们点击了“关注”。当公众号发文章时，它不需要一个个给粉丝打电话，它只需要群发一次，所有粉丝手机都会响。</li></ul><h5 id="_4-2、为什么需要它" tabindex="-1"><a class="header-anchor" href="#_4-2、为什么需要它"><span>4.2、为什么需要它？</span></a></h5><p>前端是事件驱动的。如果没有观察者模式，前端开发几乎无法进行：</p><ul><li>DOM 事件： btn.addEventListener(&#39;click&#39;, fn)。你就是观察者，按钮是发布者。</li><li>Vue/React 的响应式： 数据变了（发布者），页面组件（观察者）自动重新渲染。</li><li>组件通信： 两个完全没关系的组件 A 和 B，A 想告诉 B 一件事。</li></ul><h5 id="_4-3、代码演练-手写一个简单的-发布订阅机" tabindex="-1"><a class="header-anchor" href="#_4-3、代码演练-手写一个简单的-发布订阅机"><span>4.3、代码演练：手写一个简单的“发布订阅机”</span></a></h5><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">EventEmitter</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 仓库：存放所有的订阅关系</span></span>
<span class="line">        <span class="token comment">// 格式：{ &#39;事件名&#39;: [回调函数1, 回调函数2] }</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>events <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 1. 订阅（关注公众号）</span></span>
<span class="line">    <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 2. 发布（给公众号发文章）</span></span>
<span class="line">    <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">callback</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// 通知所有关注的人</span></span>
<span class="line">                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 3. 取消订阅（取消关注公众号）</span></span>
<span class="line">    <span class="token function">off</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">h</span> <span class="token operator">=&gt;</span> h <span class="token operator">!==</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// --- 实战使用 ---</span></span>
<span class="line"><span class="token keyword">const</span> bus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 组件 A：订阅“天气变化”</span></span>
<span class="line">bus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;weather_change&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;组件 A 收到通知：今天天儿不错，是 &#39;</span> <span class="token operator">+</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 组件 B：订阅“天气变化”</span></span>
<span class="line">bus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;weather_change&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;组件 B 收到通知：赶紧收衣服，外面 &#39;</span> <span class="token operator">+</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 某个时刻，天气真的变了（发布消息）</span></span>
<span class="line">bus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;weather_change&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;大暴雨&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-4、思考-如果一个组件被销毁了-比如用户离开了当前页面-但它之前订阅的消息没有被取消-off-会发生什么后果" tabindex="-1"><a class="header-anchor" href="#_4-4、思考-如果一个组件被销毁了-比如用户离开了当前页面-但它之前订阅的消息没有被取消-off-会发生什么后果"><span>4.4、思考？如果一个组件被销毁了（比如用户离开了当前页面），但它之前订阅的消息没有被取消（off），会发生什么后果？</span></a></h5><p><em><strong>结论：组件销毁，订阅绝不会自动消失！这是造成前端内存泄漏的最主要原因之一</strong></em></p><ul><li>原理： 当你在组件里执行了 bus.on(&#39;event&#39;, callback)，这个 callback 函数会被存入 EventEmitter 实例（那个单例）的 events 数组里。</li><li>后果： 即使你的组件在页面上被销毁了，只要 EventEmitter 这个全局单例还在，它就一直拽着这个 callback 不放。因为函数闭包的存在，这个 callback 又拽着组件里的变量不放。</li><li>结局： 垃圾回收机制（GC）发现这个组件还有人“引用”着，就不敢回收它。久而久之，你的网页占用的内存会越来越大，最后直接卡死。</li></ul><p>所以： 必须在组件销毁的生命周期（如 Vue 的 beforeUnmount 或 React 的 useEffect 的 return 中）手动调用 bus.off()。</p><h5 id="_4-5、实战举例" tabindex="-1"><a class="header-anchor" href="#_4-5、实战举例"><span>4.5、实战举例</span></a></h5><p>实战一：全站的主题换肤（暗黑模式切换） <br> 第一步：写一个全局事件总线</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> EventBus <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">events</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">// 订阅</span></span>
<span class="line">  <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">// 发布</span></span>
<span class="line">  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">handler</span> <span class="token operator">=&gt;</span> <span class="token function">handler</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">// 取消订阅</span></span>
<span class="line">  <span class="token function">off</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">h</span> <span class="token operator">=&gt;</span> h <span class="token operator">!==</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第二步：在“侧边栏及其他组件”里使用</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Sidebar.vue</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">onThemeChange</span><span class="token punctuation">(</span><span class="token parameter">newTheme</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;侧边栏：收到！我也要变&#39;</span> <span class="token operator">+</span> newTheme <span class="token operator">+</span> <span class="token string">&#39;色了&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">// 执行具体的改色逻辑</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 1. 组件挂载时：订阅</span></span>
<span class="line"><span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  EventBus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;theme-update&#39;</span><span class="token punctuation">,</span> onThemeChange<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 2. 组件销毁时：取消订阅（防止内存泄漏！）</span></span>
<span class="line"><span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  EventBus<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#39;theme-update&#39;</span><span class="token punctuation">,</span> onThemeChange<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第三步：在“设置页面”里触发</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// SettingPage.vue</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">toggleTheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token string">&#39;dark&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 喊一嗓子，全站所有订阅了 &#39;theme-update&#39; 的组件都会动起来</span></span>
<span class="line">EventBus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;theme-update&#39;</span><span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实战二：一个 “多人在线文档编辑”（像腾讯文档、Google Docs）。当用户 A 修改了第一段文字，服务器推过来一条消息。如何利用发布订阅模式，让页面上负责显示的组件自动更新？ 在“多人在线文档”这个场景下：</p><ul><li>订阅者（Observer/Subscriber）：不是“用户”，而是页面上的具体组件（比如：编辑器组件、协作列表组件、评论区组件）。</li><li>发布者（Publisher）：是那个负责和服务器打交道的 WebSocket 管理模块。</li></ul><p>完整的逻辑链路应该是这样的：</p><ul><li>建立频道： 你的前端应用启动一个 WebSocket 单例，它专门负责监听服务器的哨声。</li><li>组件订阅： “编辑器组件”在加载时，告诉事件总线：“如果有 content-update（内容更新）的消息，请叫我，并执行我的 updateText 方法”。</li><li>消息到达： 用户 A 修改了文档，服务器通过 WebSocket 发送了一个包给用户 B。</li><li>触发发布（Emit）： WebSocket 模块收到包，它不直接去改 DOM，而是调用 EventBus.emit(&#39;content-update&#39;, data)。</li><li>自动更新： 事件总线（EventBus）立刻翻开小本子，发现“编辑器组件”订阅了，于是执行它的回调函数。编辑器组件拿到新数据，更新画面。</li></ul><p>为什么要这么转一道手？直接在 WebSocket 收到消息时改组件不行吗？ <br> 不行。 因为：</p><p>解耦： WebSocket 模块只需要负责收发消息，它不需要知道页面上有哪些组件，也不需要知道组件叫什么名字。</p><ul><li>多重响应： 同样一条服务器消息（比如“用户 A 下线了”），可能需要同时触发：1. 协作列表里头像变灰；2. 聊天框显示“某某退出”；3. 弹出气泡提醒。</li><li>发布订阅模式让你只需要 emit 一次，剩下的活儿由各个组件自己领回去做。</li></ul><p>实战三：在一个SaaS系统里，全局“消息通知”系统，无论用户是在“个人设置”里修改了头像，还是在“消息页面”收到了新私信，或者“系统后台”推送了强制下线指令，你都需要在页面的右上角弹出一个 Toast（气泡通知）。 <br> 如果不写这个模式，你必须在每个可能触发消息的组件里去手动引入 Notification 组件并调用它。如果有一天你想把气泡通知换成弹窗通知，你需要改 100 个地方。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// --- EventBus.js (核心调度中心) ---</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">EventEmitter</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handlers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>handlers<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handlers<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>handlers<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handlers<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>handlers<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">off</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handlers<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>handlers<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handlers<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">h</span> <span class="token operator">=&gt;</span> h <span class="token operator">!==</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> authBus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// --- Navbar.vue (导航栏组件) ---</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> authBus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./EventBus&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 组件挂载时订阅</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">onLogout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> userAvatar<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">authBus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;logout&#39;</span><span class="token punctuation">,</span> onLogout<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 组件销毁前取消订阅（防止内存泄漏！）</span></span>
<span class="line"><span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> authBus<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#39;logout&#39;</span><span class="token punctuation">,</span> onLogout<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// --- Settings.vue (设置页面) ---</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> authBus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./EventBus&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">handleLogout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 喊一嗓子，所有订阅了 logout 的组件都会感知并执行逻辑</span></span>
<span class="line">    authBus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;logout&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 1. 全局事件总线 (EventBus.js)</span></span>
<span class="line"><span class="token keyword">const</span> bus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用我们之前写的那个类</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 2. 消息通知组件 (Toast.vue / Toast.jsx)</span></span>
<span class="line"><span class="token comment">// 这个组件在 App 根目录挂载一次，静静等待“哨声”</span></span>
<span class="line">bus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;show-message&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">renderToast</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>text<span class="token punctuation">,</span> data<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// type 可以是 &#39;success&#39; 或 &#39;error&#39;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 3. 业务组件 A：修改个人资料</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">updateProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ... 异步请求逻辑</span></span>
<span class="line">  bus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;show-message&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&#39;资料修改成功！&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;success&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 4. 业务组件 B：网络拦截器 (Axios Interceptor)</span></span>
<span class="line"><span class="token comment">// 只要接口报错，统一喊一嗓子</span></span>
<span class="line">instance<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  bus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;show-message&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&#39;网络开小差了&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;error&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5、装饰器模式-进阶必备-优雅地给代码-打补丁" tabindex="-1"><a class="header-anchor" href="#_5、装饰器模式-进阶必备-优雅地给代码-打补丁"><span>5、装饰器模式（进阶必备，优雅地给代码“打补丁”）</span></a></h4><h5 id="_5-1、什么是装饰器模式" tabindex="-1"><a class="header-anchor" href="#_5-1、什么是装饰器模式"><span>5.1、什么是装饰器模式？</span></a></h5><p>定义： 在不改变原对象的基础上，动态地给对象添加功能。</p><p>通俗点说： 它就像**“给手机套个壳”**。</p><ul><li>你的手机（原对象）原本只能打电话。</li><li>你套个“带支架的壳”：手机多了支架功能。</li><li>你套个“防水壳”：手机多了防水功能。</li><li>核心： 你没有把手机拆开去改里面的零件，手机还是那个手机。</li></ul><h5 id="_5-2、前端实战场景-给-老代码-加新功能" tabindex="-1"><a class="header-anchor" href="#_5-2、前端实战场景-给-老代码-加新功能"><span>5.2、前端实战场景：给“老代码”加新功能</span></a></h5><p>实战一：假设你公司有一个写了 3 年的旧函数 submitForm，逻辑非常乱，你不敢乱动里面的代码。现在老板要求：在每次提交前，都要加一个“埋点统计”逻辑。</p><p>痛苦写法： 直接进到 submitForm 内部，在第一行塞入统计代码。这违背了“开闭原则”（对修改关闭），万一你手抖删了个分号，整个提交功能就挂了。</p><p>装饰器写法：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 1. 原有的老函数（不敢乱动）</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">submitForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;正在执行极其复杂的提交逻辑...&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">// ... 500 行老代码</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 2. 编写一个装饰器函数</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">withLog</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;--- 埋点统计：用户点击了提交按钮 ---&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 新加的功能</span></span>
<span class="line">      </span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行原有的逻辑</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 3. 包装一下</span></span>
<span class="line"><span class="token keyword">const</span> smartSubmit <span class="token operator">=</span> <span class="token function">withLog</span><span class="token punctuation">(</span>submitForm<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 4. 调用（功能增强了，但原函数没变）</span></span>
<span class="line"><span class="token function">smartSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实战二：后端接口有时会不稳定（比如网络抖动），我们希望某些关键接口（比如提交订单）如果失败了，能自动重新尝试 3 次，而不是直接给用户报错。</p><p>这时候就需要用到装饰器模式了。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// --- Decorators.js (工具函数) ---</span></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Function<span class="token punctuation">}</span></span> <span class="token parameter">fn</span> 原函数</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>number<span class="token punctuation">}</span></span> <span class="token parameter">retries</span> 重试次数</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">withRetry</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> retries <span class="token operator">=</span> <span class="token number">3</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> lastError<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> retries<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">第 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 次尝试...</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行原函数</span></span>
<span class="line">      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        lastError <span class="token operator">=</span> err<span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 如果是最后一次尝试也失败了，就抛出错误</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> retries <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> lastError<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// --- api.js (业务逻辑) ---</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> withRetry <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./Decorators&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 1. 原始的请求逻辑：只管发请求，不关心重试</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">rawGetOrderData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/api/order/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> res<span class="token punctuation">.</span>data<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 2. 装饰一下：赋予它“失败自动重试 3 次”的能力</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> getOrderData <span class="token operator">=</span> <span class="token function">withRetry</span><span class="token punctuation">(</span>rawGetOrderData<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// --- 页面使用 ---</span></span>
<span class="line"><span class="token comment">// 如果网络波动，控制台会打印“第 1 次尝试...”，失败了会自动来第 2 次</span></span>
<span class="line"><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getOrderData</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5-3、核心总结" tabindex="-1"><a class="header-anchor" href="#_5-3、核心总结"><span>5.3、核心总结</span></a></h5><ul><li>它和工厂模式的区别： 工厂是创建一个新对象；装饰器是包装一个老对象。</li><li>它的最大好处： 极大地提高了代码的可复用性。你可以写一个 @checkAuth 装饰器，然后把它套在任何需要权限的方法上，就像贴贴纸一样方便。</li></ul>`,93)]))}const i=s(e,[["render",c]]),u=JSON.parse('{"path":"/Advanced/","title":"","lang":"en-US","frontmatter":{},"git":{"contributors":[{"name":"shadowkayn","username":"shadowkayn","email":"166908056@qq.com","commits":1,"url":"https://github.com/shadowkayn"}],"changelog":[{"hash":"41df4eb1a1304877a17c85ac637adbe678162855","time":1770709903000,"email":"166908056@qq.com","author":"shadowkayn","message":"feat: 设计模式"}]},"filePathRelative":"Advanced/README.md"}');export{i as comp,u as data};
